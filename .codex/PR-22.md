# PR-22: MQTT adapter scaffolding (edge-friendly provisioning, no broker assumption)

## Goal
Add MQTT-based interaction mode for IoT/edge provisioning as an adapter, without changing deployer core.

## Scope
Adapter + protocol conventions; no managed broker required.

## Changes
- Implement `mqtt` InteractionAdapter behind gates:
  - requires `--allow-network` AND `--interaction mqtt` (or auto selection) AND policy allows it
- Add flags:
  - `--mqtt-broker <url>`
  - `--device-id <id>` (or derive deterministically)
  - `--mqtt-topic-prefix greentic/install`
- Protocol:
  - publish schema to: `greentic/install/<device-id>/schema`
  - listen for answers on: `greentic/install/<device-id>/answers`
  - publish status on: `greentic/install/<device-id>/status`
- Ensure timeouts and retries are deterministic.

## Acceptance Criteria
- In test mode, a simulated MQTT client can:
  - receive schema
  - publish answers
  - observe status transitions
- Adapter refuses to run when offline-only or network not allowed.

## Tests
- Integration test using an in-process or test broker (if repo has one).
  - If no broker is acceptable in CI, add a “mock transport” test harness for MQTT adapter interface.
- Unit tests: topic naming conventions.

## Notes
- Do not require NATS here; MQTT is explicitly for edge provisioning.
- Keep credentials handling out of config; use secrets-store if needed later.
